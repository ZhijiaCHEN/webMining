clc;
clear all;
close all;
pkg load signal;


% signal def
sig = [
2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,9,10,11,12,13,14,15,16,17,18,19,20,21,22,20,21,22,20,21,22,23,24,25,26,24,25,26,24,25,26,20,21,22,20,21,22,20,21,22,27,28,29,30,31,29,30,31,32,33,34,35,36,37,35,38,39,40,39,40,39,40,39,40,35,38,39,40,35,38,39,40,39,40,39,40,35,38,39,40,39,40,39,40,39,40,39,40,39,40,35,38,39,40,39,40,39,40,39,40,39,40,39,40,39,40,39,40,39,40,39,40,39,40,35,41,42,43,44,35,44,45,46,47,48,49,50,51,52,50,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,62,63,64,65,66,67,64,65,68,69,70,69,70,69,70,69,70,71,72,73,74,75,76,77,45,78,79,80,81,82,83,84,85,86,87,88,89,90,86,87,88,89,90,91,90,86,87,88,89,90,91,90,86,87,88,89,90,91,90,86,87,88,89,90,91,90,86,87,88,89,90,91,90,92,93,94,95,96,97,98,99,100,101,102,103,98,99,100,101,102,103,98,99,100,101,102,103,98,99,100,101,102,103,98,99,100,101,102,103,98,99,100,101,102,103,104,105,106,107,108,106,107,108,106,107,108,106,107,108,106,107,108,106,107,108,109,110,111,112,113,114,113,114,115,116,113,114,113,114,109,110,111,112,113,114,113,114,115,116,113,114,113,114,117,118,119,120,121,119,122,119,122,119,122,119,118,123,124,125,126
];
signal = sig - mean(sig);
signal = signal .* hann(length(signal))';
signal = [signal zeros(1,2*length(signal))];
n = length(signal);

% ACF
acf = xcorr(signal,"unbiased");
acf = acf(n:length(acf));
acf = acf - mean(acf);

% DCT
ct = dct(signal);
ct_dev = std(ct);

% PSD
psd = abs(fft(signal)).^2;
psd = zscore(psd);
psd_dev = std(psd);
for i=2:1:length(psd)-1
	if (psd(i-1) < psd(i)) && (psd(i+1) < psd(i))
		peak(i)=1;
	end
end

% plots
figure;

subplot(5,1,1);
plot([0:length(sig)-1],sig,'k.-');

subplot(5,1,2);
plot([0:n-1],signal,'k.-');

subplot(5,1,3);
plot([0:n-1],psd,'k.-'); hold on;
plot(find(peak==1)-1,psd(find(peak==1)),'ro');
%plot([0:n-1],ones(1,n)*psd_dev,'r'); hold on;
%plot([0:n-1],ones(1,n)*psd_dev*2,'g'); hold on;
%plot([0:n-1],ones(1,n)*psd_dev*3,'b'); hold on;
%plot([0:n-1],ones(1,n)*psd_dev*4,'y'); hold on;
%plot([0:n-1],ones(1,n)*psd_dev*5,'k'); hold on;
%legend("PSD","std","2*std","3*std");

subplot(5,1,4);
plot([0:n-1],zscore((ct)),'k.-'); hold on;
%plot([0:n-1],ones(1,n)*ct_dev,'r');
%plot([0:n-1],ones(1,n)*ct_dev*2,'g');
%plot([0:n-1],ones(1,n)*ct_dev*3,'b');
%plot([0:n-1],ones(1,n)*ct_dev*4,'y');
%plot([0:n-1],ones(1,n)*ct_dev*5,'k');
%legend("CT","std","2*std","3*std");

subplot(5,1,5);
plot([0:n-1],acf,'k.-');
legend("ACF");

% --------

symbols = unique(sig);
for i=1:length(symbols)
	symbol = symbols(i);
	recpos = unique([1 find(sig==symbol) n]);
	if length(recpos) > 3 
		recsize = diff(recpos);
		m = mean(recsize);
		sd = std(recsize);
		cv = sd/m;
		% recsize std dev; recsize mean; #rec;
		score(symbol,:)=[symbol cv sd m length(recpos)];
	end
end


