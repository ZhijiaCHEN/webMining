clc;
clear all;
close all;
pkg load optim;

% input size
x=[935 288 541 593 407 1201 574 1623 449 1215 861 267 1736 1540 1725 1337 1291 ...
750 1508 313 863 1010 280 630 210 614 861 436 370 699 328 226 928 870 894 ...
187 517 1099 419 575 330 695 327 719 757 643 1666 252 218 1053 611 667 489 ...
2381 3443 2843 1475 1239 3907 2256 3898 1931 2753 3555 1471 1048 445 5762 ...
2834 1742 1806 1795 2424 946 2270 2458 918 2035 2309 464 294 1337 3532 ...
5266 1689 1107 6353 3149 2519 918 3107 8118 3918 3477 6496 3011 1913 1018 ...
11958 3371 1106 5507 5946 3245 3846 2400 2966 2408 2408 959 4009 891 778 ...
3128 23 517 1169 1588 2235 3338 765 1361 708 718 994 18351 2954 2757 3035 ...
2374 4260 2442 5699 1073 1226 1452 4290 532 571 116 474 1707 427 1108 549 ...
1137 1182 733 352 521 1143 697 442 641 541 1380 910 434 1181 797 891 532 ...
340 925 514 586 448 587 131 942 452 1562 567 972 723 150 1586 192 537 1104 ...
395 431 957 657 2942 3052 12105 7330 3522 2388 4560 674 3733 3887 5036 1934 ...
2310 8354 10510 1527 6016 877 3282 2073 9714 3667 1742 1355 8255 9517 2837 ...
425 7671 5912 1712 3901 2301 4393 3440 6939 1791 3286 2022 1496 6700 1798 ...
1258 618 1786 5480 780 787 787 4018 3943 3823 4215 4049 3598 4158 4101 2289 ...
3989 3934 3925 545 481 461 2482 2371 2159 2263 2296 1836 1083 982 1025 988 ...
1005 468 2571 2515 2517	]';

% running time
y=[0.064811 0.040948 0.069699 0.101619 0.073422 0.054626 0.051148 0.085433 0.101263 ...
0.096694 0.111130 0.041609 0.102908 0.152535 0.187287 0.123557 0.091990 0.108575 ...
0.086612 0.070176 0.052473 0.060716 0.052123 0.045061 0.042999 0.047168 0.080562 ...
0.071814 0.074756 0.079426 0.012163 0.041057 0.079312 0.076267 0.057426 0.010196 ...
0.021670 0.111798 0.040890 0.046848 0.043400 0.077914 0.047421 0.129657 0.051228 ...
0.046670 0.026246 0.006859 0.043457 0.058060 0.059724 0.077851 0.100905 0.147152 ...
0.162290 0.139349 0.109478 0.134933 0.196568 0.076147 0.155874 0.123731 0.143632 ...
0.101683 0.103019 0.057258 0.114650 0.235817 0.234153 0.202627 0.092220 0.103385 ...
0.084868 0.024672 0.114470 0.123010 0.070834 0.096833 0.137972 0.050507 0.017463 ...
0.230407 0.136824 0.273655 0.082138 0.110782 0.265279 0.111816 0.150536 0.113239 ...
0.160833 0.216962 0.380340 0.180437 0.247789 0.152705 0.106593 0.053510 0.503417 ...
0.180869 0.087649 0.212745 0.178758 0.141268 0.176746 0.097983 0.109287 0.125363 ...
0.165480 0.172186 0.155967 0.082858 0.052085 0.118046 0.003298 0.050429 0.063724 ...
0.071422 0.115283 0.319329 0.136296 0.068649 0.054613 0.055294 0.095420 0.322091 ...
0.086047 0.222325 0.158367 0.236509 0.222249 0.139115 0.310175 0.057578 0.071364 ...
0.120794 0.192367 0.083102 0.050379 0.005868 0.045467 0.107138 0.100893 0.115468 ...
0.045703 0.018169 0.065759 0.052712 0.037687 0.082850 0.027873 0.103103 0.101186 ...
0.104108 0.049209 0.061346 0.053557 0.007658 0.065357 0.045600 0.058035 0.012963 ...
0.093838 0.057793 0.074291 0.044855 0.049193 0.092945 0.042696 0.085033 0.045836 ...
0.127600 0.017373 0.089366 0.077025 0.009627 0.067660 0.037846 0.044755 0.087125 ...
0.080325 0.060820 0.043048 0.054885 0.152879 0.201742 0.496444 0.402398 0.296452 ...
0.171957 0.286818 0.031435 0.133088 0.188752 0.211805 0.089676 0.118069 0.430203 ...
0.354426 0.157443 0.202923 0.073020 0.332934 0.115606 0.320875 0.129987 0.177568 ...
0.181099 0.337602 0.351674 0.239554 0.032139 0.320420 0.270818 0.169581 0.170744 ...
0.152951 0.174122 0.181020 0.330704 0.162210 0.137978 0.137888 0.051059 0.179612 ...
0.081989 0.097593 0.104824 0.089242 0.307933 0.081584 0.081148 0.080350 0.198038 ...
0.183743 0.169228 0.176101 0.145247 0.131254 0.211235 0.211167 0.121212 0.187662 ...
0.181690 0.184568 0.022990 0.090911 0.051655 0.108757 0.122441 0.114029 0.186332 ...
0.175520 0.161457 0.132400 0.100386 0.101473 0.097499 0.111406 0.027084 0.398319 0.131893 0.131210]';

y = [0.572 0.58 0.574 0.58 0.58 0.638 0.564 0.588 0.566 0.636 1.559 ...
0.581 0.569 0.587 0.564 0.58 0.574 0.696 0.604 0.682 0.628 0.584 ...
0.564 0.664 0.625 0.599 0.591 0.635 0.601 0.618 0.674 0.606 0.631 ...
0.829 0.626 0.649 0.607 0.586 0.734 0.61 0.604 0.61 0.684 0.646 ...
0.605 0.658 0.606 0.624 0.615 0.787 0.754 0.754 0.725 0.749 0.635 ...
0.875 1.057 0.655 0.846 0.708 0.666 0.684 0.943 0.844 0.821 0.98 ...
0.641 0.681 0.607 0.808 0.907 0.853 0.766 0.808 0.715 0.983 0.82 ...
0.845 0.707 0.798 0.891 0.85 0.851 0.997 0.729 0.758 0.903 0.939 ...
1.047 1.032 1.616 1.064 1.199 0.966 1.038 0.912 1.967 0.943 0.996 ...
0.996 1.043 1.019 1.018 1.018 0.862 1.048 1.135 1.141 0.981 1.011 ...
1.058 1.223 1.641 1.108 1.335 1.169 1.487 1.177 1.192 1.422 1.475 ...
1.522 1.296 2.672 1.692 1.742 1.88 2.235]';

x = [187 210 218 226 252 267 288 280 313 449 328 327 330 370 407 419 436 ...
425 461 468 481 517 541 545 574 575 593 611 630 614 618 643 695 674 ...
699 719 750 757 780 787 787 870 861 861 863 877 894 928 935 982 988 ...
1005 1010 1025 1053 1083 1099 1201 1215 1258 1291 1347 1355 1540 1496 ...
1527 1508 1623 1666 1725 1712 1742 1786 1791 1798 1736 1836 1934 2022 ...
2159 2263 2289 2296 2301 2310 2371 2388 2482 2515 2517 2571 2942 3052 ...
3440 3523 3598 3286 3667 3733 3823 3833 3887 3925 3934 3901 3943 3989 ...
4018 4049 4101 4158 4215 7330 4393 4560 5036 5480 5912 6016 6700 6939 ...
7671 8255 8354 9517 9714 10510 12105]';

funcs = {
{@(x, p) p(1)*log2(p(2)*x) ,"O(log(n))"},
{@(x, p) p(1)*x +p(2),"O(n)"},
{@(x, p) p(1)*x.*log2(p(2)*x),"O(nlog(n))"},
{@(x, p) p(1)*x.^2 + p(2),"O(n^2)"},
{@(x, p) p(1)*pow2(x*p(2)),"O(2^n)"}
};

maxR2 = -Inf;
for i=1:1:length(funcs)
	[f, p, cvg, iter, corp, covp, covr, stdresid, Z, r2]=leasqr(x,y,[0.001; 0.001],funcs{i}{1},0.00001,100, ones(size(x)));
	maxR2 = max(maxR2, r2);
	fitness{i} = {p, r2};
	[funcs{i}{2} " R2 = " num2str(r2)]
end

figure;
plot(x,y,'k+'); hold;

xx = linspace(min(x), max(x));
bestfit = "";
for i=1:1:length(funcs)
	if maxR2 == fitness{i}{2};
		sd = std(y);
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}),'k-');
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}).-2*sd,'k:');
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}).+2*sd,'k:');
		bestfit = [funcs{i}{2} " R2 = " num2str(maxR2)];
	end
end
ylabel("running time (in seconds)");
xlabel("document size (in # of nodes)");
legend("data", [bestfit], "95% interval");

return
