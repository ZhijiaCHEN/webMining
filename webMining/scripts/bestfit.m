clc;
clear all;
close all;
pkg load optim;

% input size
x=[846 933 278 525 555 401 1153 550 1620 313 1198 1020 271 1834 1494 1667 1289 ...
   1249 725 1556 335 859 924 280 600 210 601 838 418 369 684 322 222 710 831 ...
   884 182 517 1107 417 551 330 661 323 1662 738 614 245 219 1030 595 780 787 ...
   787 4017 3942 3822 4215 4049 3598 4178 4121 2287 3945 3890 3881 545 481 461 ...
   2482 2371 2159 2263 2296 1836 1061 963 1006 969 986 468 2519 2521]';

% running time
y=[0.039000 0.043000 0.006000 0.014000 0.026000 0.011000 0.018000 0.014000 0.104000 ...
   0.009000 0.045000 0.038000 0.004000 0.068000 0.041000 0.054000 0.044000 0.033000 ...
   0.016000 0.045000 0.009000 0.035000 0.027000 0.011000 0.014000 0.005000 0.010000 ...
   0.027000 0.012000 0.016000 0.018000 0.015000 0.008000 0.026000 0.013000 0.038000 ...
   0.008000 0.016000 0.036000 0.013000 0.027000 0.013000 0.011000 0.025000 0.025000 ...
   0.026000 0.016000 0.003000 0.008000 0.020000 0.027000 0.020000 0.020000 0.021000 ...
   0.191000 0.203000 0.173000 0.181000 0.171000 0.119000 0.158000 0.151000 0.091000 ...
   0.167000 0.151000 0.167000 0.012000 0.014000 0.014000 0.060000 0.051000 0.041000 ...
   0.085000 0.064000 0.060000 0.026000 0.024000 0.019000 0.022000 0.028000 0.006000 ...
   0.089000 0.105000]';

y = [0.572 0.58 0.574 0.58 0.58 0.638 0.564 0.588 0.566 0.636 1.559 ...
0.581 0.569 0.587 0.564 0.58 0.574 0.696 0.604 0.682 0.628 0.584 ...
0.564 0.664 0.625 0.599 0.591 0.635 0.601 0.618 0.674 0.606 0.631 ...
0.829 0.626 0.649 0.607 0.586 0.734 0.61 0.604 0.61 0.684 0.646 ...
0.605 0.658 0.606 0.624 0.615 0.787 0.754 0.754 0.725 0.749 0.635 ...
0.875 1.057 0.655 0.846 0.708 0.666 0.684 0.943 0.844 0.821 0.98 ...
0.641 0.681 0.607 0.808 0.907 0.853 0.766 0.808 0.715 0.983 0.82 ...
0.845 0.707 0.798 0.891 0.85 0.851 0.997 0.729 0.758 0.903 0.939 ...
1.047 1.032 1.616 1.064 1.199 0.966 1.038 0.912 1.967 0.943 0.996 ...
0.996 1.043 1.019 1.018 1.018 0.862 1.048 1.135 1.141 0.981 1.011 ...
1.058 1.223 1.641 1.108 1.335 1.169 1.487 1.177 1.192 1.422 1.475 ...
1.522 1.296 2.672 1.692 1.742 1.88 2.235]';

x = [187 210 218 226 252 267 288 280 313 449 328 327 330 370 407 419 436 ...
425 461 468 481 517 541 545 574 575 593 611 630 614 618 643 695 674 ...
699 719 750 757 780 787 787 870 861 861 863 877 894 928 935 982 988 ...
1005 1010 1025 1053 1083 1099 1201 1215 1258 1291 1347 1355 1540 1496 ...
1527 1508 1623 1666 1725 1712 1742 1786 1791 1798 1736 1836 1934 2022 ...
2159 2263 2289 2296 2301 2310 2371 2388 2482 2515 2517 2571 2942 3052 ...
3440 3523 3598 3286 3667 3733 3823 3833 3887 3925 3934 3901 3943 3989 ...
4018 4049 4101 4158 4215 7330 4393 4560 5036 5480 5912 6016 6700 6939 ...
7671 8255 8354 9517 9714 10510 12105]';

funcs = {
{@(x, p) p(1)*log2(p(2)*x) ,"O(log(n))"},
{@(x, p) p(1)*x +p(2),"O(n)"},
{@(x, p) p(1)*x.*log2(p(2)*x),"O(nlog(n))"},
{@(x, p) p(1)*x.^2 + p(2),"O(n^2)"},
{@(x, p) p(1)*pow2(x*p(2)),"O(2^n)"}
};

maxR2 = -Inf;
for i=1:1:length(funcs)
	[f, p, cvg, iter, corp, covp, covr, stdresid, Z, r2]=leasqr(x,y,[0.001; 0.001],funcs{i}{1},0.00001,100, ones(size(x)));
	maxR2 = max(maxR2, r2);
	fitness{i} = {p, r2};
	[funcs{i}{2} " R2 = " num2str(r2)]
end

figure;
plot(x,y,'k+'); hold;

xx = linspace(min(x), max(x));
bestfit = "";
for i=1:1:length(funcs)
	if maxR2 == fitness{i}{2};
		sd = std(y);
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}),'k-');
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}).-2*sd,'k:');
		plot(xx,funcs{i}{1}(xx,fitness{i}{1}).+2*sd,'k:');
		bestfit = [funcs{i}{2} " R2 = " num2str(maxR2)];
	end
end
ylabel("running time (in seconds)");
xlabel("document size (in # of nodes)");
legend("data", [bestfit], "95% interval");

return
